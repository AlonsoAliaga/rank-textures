<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./style.css">
  <link rel="shortcut icon" href="https://cdn.discordapp.com/emojis/791742603183259648.webp?size=96&quality=lossless" type="image/x-icon">
  <title>Support us by watching some ads!</title>
  <style>
    body{
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .space {
      background-color:#ffffff00;
      height: 10px;
      width: 450px;
      margin: 5px;
    }
    .content-block {
      box-shadow: 0px 0px 5px 2px rgba(0, 0, 0, 0.4);
      padding: 5px;
      border-width: 4px;
      /* border-style: double; */
      border-radius: 15px;
      width: 750px;
    }
    img {
      /* box-shadow: 0px 0px 5px 2px rgba(0, 0, 0, 0.4); */
      border-radius: 5px;
    }
    p {
      margin: 3px !important;
    }
  </style>
</head>
<body>
  <div style="width: 100%;" id="content">
    <button style="height: 80px;width: 100%;font-size: 20px;border-radius: 0px;background-color: #ff8d00;font-weight: bold;" class="darkbuttonboxes" id="support-button">Loading..</button>
  </div><br>
  <span style="left: calc(50% - 270px);" id="snackbar"><b>‚åõ Reduce waiting time by clicking ads! ‚åõ</b><br><span style="font-size: small;">Thanks for your support!</span></span>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5185973148525065"
    crossorigin="anonymous"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-5185973148525065",
    //   enable_page_level_ads: true,
      overlays: { bottom: true },          // banner ‚Äúanchor‚Äù en la parte inferior :contentReference[oaicite:4]{index=4}
      vignette: true                    // si quieres tambi√©n intersticiales
    });
  </script>
  <script>
    let active = true;
    let uniqueID;
    let thirdID;
    let fnS;
    let reduceInterval;
    populate();
    function populate(){
      fetch(decodeAndAdd("aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0Fsb25zb0FsaWFnYS9BbG9uc29BbGlhZ2FBUEkvcmVmcy9oZWFkcy9tYWluL2FwaS9hZHMvYWRzLmpzb24="))
        .then(res => res.json())
        .then(content => {
          //const decoded = atob(content.content);
          //const parsed = JSON.parse(decoded);
          let adsData = content;
          //adsData = [...content,...content]
          //console.log(content)
          for(let adData of adsData) {
            //console.log(adData);
            let imageLink = adData.Image;
            let title = adData.Title;
            let link = adData.Link;
            let lines = adData.Lines;
            let priority = adData.Priority;
            let div = document.createElement("div");
            div.classList.add("content-block");
            let img = document.createElement("img");
            img.src = imageLink; 
            img.style.width = "100%";
            img.style.cursor = "pointer";
            img.onclick = function(event) {
                window.open(link,"_blank");
            };
            div.appendChild(img);
            let h2 = document.createElement("h2");
            h2.innerHTML = title;
            div.appendChild(h2);
            for (let line of lines) {
                let p = document.createElement("p");
                p.innerHTML = line;
                div.appendChild(p);
            }
            document.body.appendChild(div);
            let space = document.createElement("div");
            space.classList.add("space");
            document.body.appendChild(space);
          }
          setTimeout(()=>{
            let div = document.createElement("div");
            let h2 = document.createElement("h2");
            h2.style.cssText = "font-size: 15px ;text-align: center;";
            h2.innerHTML = `<br>‚ù§Ô∏è Thank you for visiting this site. Check our tools in <a href="https://alonsoaliaga.com/site" rel="noopener" target="_blank">our official site</a>!<br><br>`
            div.appendChild(h2);
            document.body.appendChild(div);
          },1000);
        });
    }
    function decodeAndAdd(toDecode) {
      return `${atob(toDecode)}?${generateRandomString(10)}`
    }
    function generateRandomString(length) {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        const charactersLength = characters.length;
        for (let i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
    }
    window.addEventListener('message', async function(event) {
        // if (event.origin !== 'https://alonsoaliaga.github.io') return;
        if(typeof event.data != "undefined") {
            let data = event.data;
            if(data.step == 1) {
                //console.log(`Received Step #1`)
                uniqueID = data.uuid;
                fnS = data.fn;
                start();
            }else if(data.step == 3) {
                if(uniqueID != data["support-id"]) {
                    //console.log(`Different ids: ${uniqueID} != ${data["support-id"]}`);
                    return;
                }
                let secondId = data["second-id"];
                //console.log(`Received Step #3`)
                const fnText = data.fn;
                const fn = new Function('return ' + fnText)();
                thirdID = randomUniqueID();
                fn(secondId,thirdID);
            }else if(data.step == 5) {
                if(uniqueID != event.data["support-id"]) {
                    //console.log(`Different ids: ${uniqueID} != ${event.data["support-id"]}`);
                    return;
                }
                if(thirdID != event.data["third-id"]) {
                    //console.log(`Different third ids: ${thirdID} != ${event.data["third-id"]}`);
                    return;
                }
                let secondId = event.data["second-id"];
                thirdID = event.data["third-id"];
                //console.log(`Received Step #5`)
                const fn = function(msg) {
                    //console.log(msg);
                    window.addEventListener('focus', theEvent, {once:true});
                    function theEvent(event) {
                      window.removeEventListener('focus', theEvent);
                      window.scrollTo({
                          top: 0,
                          left: 0,
                          behavior: 'smooth'
                      });
                      setTimeout(()=>flyRocket(),1000);
                    }
                    function flyRocket(){
                      const btn = document.getElementById("unlock-features-div");
                      const rocket = document.getElementById('rocket');
                      rocket.style.display = "block";
                      const rect = btn.getBoundingClientRect();
                      const rocketRect = rocket.getBoundingClientRect();

                      const dx = rect.left + rect.width/2 - rocketRect.left;
                      const dy = rect.top + rect.height/2 - rocketRect.top;

                      rocket.style.transform = `translate(${dx}px, ${dy}px)`;
                      setTimeout(() => {
                        rocket.remove(); // optional: hide rocket after impact
                        //btn.style.backgroundColor = "rgb(128 255 103)"
                        //btn.style.fontWeight = "bold"
                        //btn.innerText = "UNLOCKED FEATURES! üöÄ\r\nExpires in 12h"
                        /*
                        let times = 0;
                        async function timeF(event) {
                          event.preventDefault();
                          if(event.type == "contextmenu" && event.ctrlKey) {
                            times += 50;
                          }else times++;
                          let emojis = getClosestValue(confetties,times);
                          //console.log(emojis)
                          customParty(emojis.split(" "),emojis == final ? 10 : 0);
                          if(confetties.has(times)) {
                            party();
                          }
                          if(emojis == final) {
                            function nothing(event) {
                              event.preventDefault();
                            }
                            unlockStatusElement.onclick = nothing;
                            unlockStatusElement.oncontextmenu = nothing;
                            try {
                              // Calculate the expiration timestamp (current time + 12 hours)
                              const unlockDurationHours = 12;
                              const unlockedUntil = Date.now() + (unlockDurationHours * 60 * 60 * 1000);
                            
                              // Generate the signature for tamper detection
                              const signature = await generateSha256Hash(unlockedUntil + SECRET_SALT_SECRET);
                            
                              // Store the timestamp and its signature in localStorage
                              const unlockData = {
                                  unlockedUntil: unlockedUntil,
                                  signature: signature
                              };
                              localStorage.setItem('appUnlockDataMcTxtSecret', JSON.stringify(unlockData));
                              console.log('Unlock data stored in localStorage:', unlockData);
                            }catch (error) {
                               console.error("Error during unlock process:", error);
                            }
                            checkUnlockStatusSecret();
                          }
                          console.log(`Times ${times}`)
                        }
                        unlockStatusElement.onclick = timeF;
                        unlockStatusElement.oncontextmenu = timeF;
                        */
                        //confettiTime();
                        checkUnlockStatus();
                      }, 1000); // match transition duration
                    }
                }
                //console.log(`Unlocking features with Step #6..`)
                let button = document.getElementById("support-button");
                button.innerText = `üéâ Special features unlocked! You can go back to the generator! üß™`;
                button.disabled = true;
                confettiTime();
                try {
                  // Calculate the expiration timestamp (current time + 12 hours)
                  const unlockDurationHours = 12;
                  const unlockedUntil = Date.now() + (unlockDurationHours * 60 * 60 * 1000);

                  // Generate the signature for tamper detection
                  const signature = await generateSha256Hash(unlockedUntil + SECRET_SALT);

                  // Store the timestamp and its signature in localStorage
                  const unlockData = {
                      unlockedUntil: unlockedUntil,
                      signature: signature
                  };
                  localStorage.setItem('appUnlockDataMcTxt', JSON.stringify(unlockData));
                  console.log('Unlock data stored in localStorage:', unlockData);

                  // Send message to the opener window (main page)
                  if (window.opener) {
                      const data = { step: 6, "support-id": uniqueID, "second-id": secondId, "third-id": thirdID, fn: fn.toString(), timestamp: Date.now() };
                      window.opener.postMessage(data, '*');
                      //window.opener.postMessage({ type: 'unlockApp', status: 'success' }, '*'); // '*' for any origin, restrict in production
                      //console.log('Unlock message sent to main page.');
                  } else {
                      console.warn('No opener window found. Cannot send unlock message.');
                  }
                  //  // Optionally, close the window after a short delay
                  //  setTimeout(() => {
                  //      window.close();
                  //  }, 1500); // Close after 1.5 seconds
                }catch (error) {
                   console.error("Error during unlock process:", error);
                   button.textContent = `üéâ Special features couldn't be unlocked! Contact us on Discord! üß™`;
                }
            }
        }
        //console.log(event)
        function start() {
            if(adBlockEnabled) {
                let button = document.getElementById("support-button");
                button.innerText = `üö´ Disable AdBlock to unlock special features.`;
                return;
            }
            countdown();
        }
        let reduced = 0;
        function countdown() {
            let button = document.getElementById("support-button");
            let time = 10 + (20/2);
            let penaltyTime = 0;
            let interval = setInterval(()=>{
                if(time < 0) {
                    ready();
                    clearInterval(interval);
                    clearInterval(reduceInterval);
                    return;
                }
                if(document.visibilityState != 'visible' || !active) {
                    button.innerText = `üö´ Please, stay in this page for ${time} seconds to continue..`;
                    penaltyTime = 2;
                }else if(penaltyTime > 0) {
                    button.innerText = `üö´ Stay in this page for ${time} seconds to continue..`;
                    penaltyTime--;
                }else{
                    button.innerText = `‚åõ Please wait ${time} seconds..`;
                    penaltyTime = 0;
                    time--;
                }
            },1000);
            const fnText = fnS;
            const fn = new Function('return ' + fnText)();
            jQuery(document).ready(function($){
            	$('iframe').iframeTracker({
            		blurCallback: function(event) {
                  if(time < 0) return;
                  if(fn(element)) {
                      let random = getRandomIntInclusive(1,4);
                      let oldTime = time;
                      time = time - random;
                      reduced = reduced + random;
                      //console.log(`You clicked an ad! Time reduced from ${oldTime} -> ${time}`)
                      button.innerText = `‚åõ Time reduced to ${Math.max(time,0)} seconds..`;
                  }
            		}
            	});
            });
            const elementsArray = Array.from(document.querySelectorAll('div.content-block img'));
            elementsArray.forEach((element) => {
              element.addEventListener('click', function(event) {
                if(time < 0) return;
                if(fn(element)) {
                    let oldTime = time;
                    time = time - 2;
                    reduced = reduced + 2;
                    //console.log(`You clicked an ad! Time reduced from ${oldTime} -> ${time}`)
                    button.innerText = `‚åõ Time reduced to ${Math.max(time,0)} seconds..`;
                }
              },false);
            });
            alertBar([`‚åõ Reduce waiting time by clicking ads! ‚åõ`,`Thanks for your support!`],6000)
            reduceInterval = setInterval(()=>{
                alertBar([`‚åõ Reduce waiting time by clicking ads! ‚åõ`,`Thanks for your support!`],6000)
            },8500);
        }
        function getRandomIntInclusive(min, max) {
          min = Math.ceil(min);
          max = Math.floor(max);
          return Math.floor(Math.random() * (max - min + 1) + min);
        }
        function ready() {
            const parentWindow = window.opener;
            if (!parentWindow) {
              alert('Sorry but.. how did you reach this page?\n\n\nYou can close this page now.');
              return;
            }
            //console.log(`Sending order for Step #2`)
            const data = { step: 2,"support-id": uniqueID, reduced: reduced,timestamp: Date.now() };
            parentWindow.postMessage(data, '*');
        }
    },false);
    document.getElementById('support-button').addEventListener('click', function() {
      const parentWindow = window.opener;
      if (!parentWindow) {
        alert('Sorry but.. how did you reach this page?\n\n\nYou can close this page now.');
        return;
      }
    //   window.opener = null;
      const data = { "support-id": uniqueID, timestamp: Date.now() };
      parentWindow.postMessage(data, '*');
    });
    function randomUniqueID() {
        if (typeof crypto.randomUUID === 'function') {
          return crypto.randomUUID();
        } else {
          // Fallback manual
          const bytes = crypto.getRandomValues(new Uint8Array(16));
          bytes[6] = (bytes[6] & 0x0f) | 0x40;
          bytes[8] = (bytes[8] & 0x3f) | 0x80;
          const hex = Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
          return [
            hex.substring(0, 8),
            hex.substring(8, 12),
            hex.substring(12, 16),
            hex.substring(16, 20),
            hex.substring(20)
          ].join('-');
        }
    }
    window.addEventListener('focus',  () => { active = true });
    window.addEventListener('blur',   () => { active = false });
    let alertMessageTimeout;
    function alertBar(text = ['Thanks for using our tool!','- AlonsoAliaga'], time = 3000) {
      //console.log(`Alerting..`);
      if(alertMessageTimeout) {
        clearTimeout(alertMessageTimeout);
        var sb = document.getElementById("snackbar");
        sb.classList.remove("show6","show");
      }
      var sb = document.getElementById("snackbar");   
      sb.innerHTML = `<b style="font-size: 25px;">${text[0]}</b><br><span style="font-size: 15px;">${text[1]}</span>`
      sb.classList.add(time == 6000 ? "show6":"show");    

      alertMessageTimeout = setTimeout(()=>{ sb.classList.remove("show6","show"); }, time);
    }
    function party(){
      const a=new AudioContext(),o=a.createOscillator(),g=a.createGain();
      o.type='square';
      o.frequency.setValueAtTime(500,a.currentTime);
      g.gain.setValueAtTime(1,a.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.3);
      o.connect(g).connect(a.destination);
      o.start();o.stop(a.currentTime+0.3);
    }
    function clap(){
      const a=new AudioContext(),b=a.createBuffer(1,a.sampleRate*0.3,a.sampleRate),
            d=b.getChannelData(0);
      for(let i=0;i<d.length;i++)d[i]=(Math.random()*2-1)*Math.pow(1-i/d.length,2);
      const s=a.createBufferSource();s.buffer=b;
      const f=a.createBiquadFilter();f.type='bandpass';f.frequency.value=1000;
      const g=a.createGain();g.gain.setValueAtTime(1,a.currentTime);
      g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+0.3);
      s.connect(f).connect(g).connect(a.destination);s.start();
    }
    function confettiTime() {
      document.createElement("button").click();
      let soundTimes = 0;
      const duration = 10 * 1 * 1000,
        animationEnd = Date.now() + duration,
        defaults = { startVelocity: 30, spread: 360, ticks: 20, zIndex: 0 };
      
      function randomInRange(min, max) {
      	return Math.random() * (max - min) + min;
      }
      const interval = setInterval(function () {
      	const timeLeft = animationEnd - Date.now();
      
      	if (timeLeft <= 0) {
          
          party();
      		return clearInterval(interval);
      	}
        soundTimes++;
        clap();
      
      	const particleCount = 25 * (timeLeft / duration);
      
      	// since particles fall down, start a bit higher than random
      	confetti(
      		Object.assign({}, defaults, {
      			particleCount,
      			origin: { x: randomInRange(0.1, 0.5), y: Math.random() - 0.2 }
      		})
      	);
      	confetti(
      		Object.assign({}, defaults, {
      			particleCount,
      			origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
      		})
      	);
      }, 250);
    }
    const SECRET_SALT = "YourSuperSecretSaltForUnlockFeature123!@#"; // Change this to a strong, unique string
    // Function to generate SHA-256 hash
    async function generateSha256Hash(message) {
        const msgUint8 = new TextEncoder().encode(message); // encode as (utf-8) Uint8Array
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8); // hash the message
        const hashArray = Array.from(new Uint8Array(hashBuffer)); // convert buffer to byte array
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
        return hashHex;
    }
  
  </script>
  <script src="resources.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery.iframetracker@2.1.0/dist/jquery.iframetracker.min.js"></script>
  <!-- <script src="script.js"></script> -->
</body>
</html>
